From 10520767b177e2eb36968960867aa74f4f803743 Mon Sep 17 00:00:00 2001
From: isimobile <isimobile@ismaakit.com>
Date: Wed, 11 Jan 2012 20:45:03 +0200
Subject: [PATCH] ril: Added support for use of Honeycomb Radio (Modem).

Change-Id: I841a8b532380bd097c1ae3ed2ba3cb1d920123df
---
 include/telephony/ril.h       |    2 ++
 libril/Android.mk             |    5 +++++
 libril/ril.cpp                |    2 ++
 reference-ril/Android.mk      |    5 +++++
 reference-ril/reference-ril.c |    2 ++
 5 files changed, 16 insertions(+), 0 deletions(-)

diff --git a/include/telephony/ril.h b/include/telephony/ril.h
index 3a3d03f..2600c78 100644
--- a/include/telephony/ril.h
+++ b/include/telephony/ril.h
@@ -199,6 +199,7 @@ typedef struct {
  */
 typedef struct {
     int             status;     /* A RIL_DataCallFailCause, 0 which is PDP_FAIL_NONE if no error */
+#ifndef HCRADIO
     int             suggestedRetryTime; /* If status != 0, this fields indicates the suggested retry
                                            back-off timer value RIL wants to override the one
                                            pre-configured in FW.
@@ -206,6 +207,7 @@ typedef struct {
                                            The value < 0 means no value is suggested.
                                            The value 0 means retry should be done ASAP.
                                            The value of MAX_INT(0x7fffffff) means no retry. */
+#endif
     int             cid;        /* Context ID, uniquely identifies this call */
     int             active;     /* 0=inactive, 1=active/physical link down, 2=active/physical link up */
     char *          type;       /* One of the PDP_type values in TS 27.007 section 10.1.1.
diff --git a/libril/Android.mk b/libril/Android.mk
index 5c96ec9..d1f3475 100644
--- a/libril/Android.mk
+++ b/libril/Android.mk
@@ -21,6 +21,11 @@ LOCAL_MODULE:= libril
 
 LOCAL_LDLIBS += -lpthread
 
+#USE HCRADIO
+ifeq ($(BOARD_USES_HC_RADIO),true)
+LOCAL_CFLAGS += -DHCRADIO
+endif
+
 include $(BUILD_SHARED_LIBRARY)
 
 
diff --git a/libril/ril.cpp b/libril/ril.cpp
index d1d5d3b..861ab8b 100644
--- a/libril/ril.cpp
+++ b/libril/ril.cpp
@@ -1547,7 +1547,9 @@ static int responseDataCallList(Parcel &p, void *response, size_t responselen)
         int i;
         for (i = 0; i < num; i++) {
             p.writeInt32((int)p_cur[i].status);
+#ifndef HCRADIO
             p.writeInt32(p_cur[i].suggestedRetryTime);
+#endif
             p.writeInt32(p_cur[i].cid);
             p.writeInt32(p_cur[i].active);
             writeStringToParcel(p, p_cur[i].type);
diff --git a/reference-ril/Android.mk b/reference-ril/Android.mk
index ec2692e..aac273f 100644
--- a/reference-ril/Android.mk
+++ b/reference-ril/Android.mk
@@ -19,6 +19,11 @@ LOCAL_CFLAGS := -D_GNU_SOURCE
 
 LOCAL_C_INCLUDES := $(KERNEL_HEADERS)
 
+#USE HCRADIO
+ifeq ($(BOARD_USES_HC_RADIO),true) 
+LOCAL_CFLAGS += -DHCRADIO
+endif
+
 ifeq ($(TARGET_DEVICE),sooner)
   LOCAL_CFLAGS += -DOMAP_CSMI_POWER_CONTROL -DUSE_TI_COMMANDS
 endif
diff --git a/reference-ril/reference-ril.c b/reference-ril/reference-ril.c
index ce2b0ce..b1a7d73 100644
--- a/reference-ril/reference-ril.c
+++ b/reference-ril/reference-ril.c
@@ -324,7 +324,9 @@ static void requestOrSendDataCallList(RIL_Token *t)
     int i;
     for (i = 0; i < n; i++) {
         responses[i].status = -1;
+#ifndef HCRADIO
         responses[i].suggestedRetryTime = -1;
+#endif
         responses[i].cid = -1;
         responses[i].active = -1;
         responses[i].type = "";
-- 
1.7.5.4

